<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Your Failure Resume</title>
    <meta name="viewport" content="width=800, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/main.css') }}">
    <style>
        body {
            background: #eee;
        }
        .a4-paper {
            width: 794px;
            min-height: 1123px;
            background: white;
            box-shadow: 0 0 8px rgba(0,0,0,0.25);
            margin: 30px auto 30px auto;
            padding: 48px 36px;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .a4-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .centered-modal {
            display: flex; align-items: center; justify-content: center;
            height: 100vh; width: 100vw;
            position: fixed; left: 0; top: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
        }
        .centered-modal input,
        .centered-modal textarea,
        .centered-modal select {
            font-family: inherit !important;
            background: #fff !important;
            color: #222 !important;
            border: 1px solid #222 !important;
            border-radius: 4px !important;
            box-shadow: none !important;
            width: 100% !important;
            padding: 7px 10px !important;
            margin-bottom: 0 !important;
            appearance: none !important;
            font-size: 1.1em;
        }
        .centered-modal label {
            color: #222 !important;
            font-weight: bold;
            display: block;
            margin-bottom: 6px;
        }
        .centered-modal h2 {
            margin-bottom: 18px;
            text-align: center;
            color: #222 !important;
        }
        .centered-modal button {
            font-family: inherit !important;
            letter-spacing: 0 !important;
            border-radius: 4px !important;
            border: none !important;
            box-shadow: none !important;
            margin: 0 4px 0 0 !important;
            font-size: 1.05em;
            padding: 10px 0 !important;
            min-width: 100px;
        }
        .centered-modal form {
            box-shadow: none !important;
        }
        .centered-modal input::-webkit-input-placeholder { color: #888; }
        .centered-modal input:-ms-input-placeholder { color: #888; }
        .centered-modal input::placeholder { color: #888; }

        /* Fix date icon, but allow system icon for date fields */
        .centered-modal input[type="date"]::-webkit-calendar-picker-indicator {
            filter: none !important;
        }
        @media (max-width: 820px) {
            .a4-paper { width: 98vw; height: auto; }
        }
    </style>
</head>
<body>
    <!-- User Info Modal -->
    <div id="userInfoModal" class="centered-modal">
      <form id="user-info-form" style="background:white; padding:32px; border-radius:8px; max-width:340px; min-width:250px;">
        <h2>Create Your Resume</h2>
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required autocomplete="off">
        <br><br>
        <label for="age">Age:</label>
        <input type="number" id="age" name="age" required min="0" autocomplete="off">
        <br><br>
        <button type="submit" style="width:100%;background:#3489eb;color:#fff;">Start</button>
      </form>
    </div>
    <!-- End User Info Modal -->

    <!-- Failure Modal -->
    <div id="failureModal" class="centered-modal" style="display:none;">
      <form id="failure-form" style="background:white; padding:32px; border-radius:8px; max-width:400px; min-width:250px;">
        <h2>Add Failure</h2>
        <label for="fail_title">Title:</label>
        <input type="text" id="fail_title" name="title" required autocomplete="off">
        <br><br>
        <label for="fail_date">Date:</label>
        <input type="date" id="fail_date" name="date" required>
        <br><br>
        <label for="fail_desc">Description:</label>
        <textarea id="fail_desc" name="desc" required></textarea>
        <br><br>
        <label for="fail_lesson">Lesson Learned:</label>
        <textarea id="fail_lesson" name="lesson" required></textarea>
        <br><br>
        <button type="submit" style="background:#3489eb;color:#fff;">Add</button>
        <button type="button" onclick="closeFailureModal()" style="background:#ccc;color:#222;margin-left:12px;">Cancel</button>
      </form>
    </div>
    <!-- End Failure Modal -->

    <!-- The A4 Resume Live Preview -->
    <div class="a4-container" id="a4-container">
        <div class="a4-paper" id="resume-page-1">
            <!-- User info and failures will appear here -->
        </div>
    </div>

    <!-- Scripts -->
   <script>
document.addEventListener("DOMContentLoaded", function() {
    // User Info Modal Logic
    document.getElementById('user-info-form').onsubmit = function(e) {
        e.preventDefault();
        // Get form values
        let name = this.name.value.trim();
        let age = this.age.value.trim();

        // Make sure the A4 container exists
        let a4container = document.getElementById('a4-container');
        let paper = document.getElementById('resume-page-1');
        if (!paper) {
            // If not found, create one
            paper = document.createElement('div');
            paper.className = 'a4-paper';
            paper.id = 'resume-page-1';
            a4container.appendChild(paper);
        }

        // Set the innerHTML
        paper.innerHTML = `<h1 style="margin-bottom:8px;">${name}</h1>
        <p><b>Age:</b> ${age}</p>
        <hr>
        <h2 style="margin-top:20px;">Failures</h2>
        <div id="failures-list"></div>
        <br>
        <button type="button" onclick="showFailureForm()" style="padding:10px 28px; background:#3489eb; color:white; border:none; border-radius:4px; font-size:1.1em;">Add Failure</button>`;

        // Hide modal
        document.getElementById('userInfoModal').style.display = 'none';

        // Save user info globally (for use in failures)
        window.userInfo = {name, age};
    };

    // Failure Modal Logic
    window.showFailureForm = function() {
        document.getElementById('failureModal').style.display = 'flex';
    }
    window.closeFailureModal = function() {
        document.getElementById('failureModal').style.display = 'none';
    }

    document.getElementById('failure-form').onsubmit = function(e) {
        e.preventDefault();

        // Get values
        let title = this.title.value.trim();
        let date = this.date.value;
        let desc = this.desc.value.trim();
        let lesson = this.lesson.value.trim();

        // Add new failure to the A4 paper live
        let failuresList = document.querySelector('.a4-paper:last-child #failures-list');
        let count = failuresList.children.length;
        if (count >= 5) {
            // Make a new page if current has 5 failures
            let a4container = document.getElementById('a4-container');
            let newPage = document.createElement('div');
            newPage.className = 'a4-paper';
            newPage.innerHTML = `<h1 style="margin-bottom:8px;">${window.userInfo.name}</h1>
            <p><b>Age:</b> ${window.userInfo.age}</p>
            <hr>
            <h2 style="margin-top:20px;">Failures</h2>
            <div id="failures-list"></div>`;
            a4container.appendChild(newPage);
            failuresList = newPage.querySelector('#failures-list');
        }
        failuresList.innerHTML += `<div style="margin-bottom:22px;">
            <b>${title}</b> (${date})<br>
            <span style="color:#888;"><i>${desc}</i></span><br>
            <strong>Lesson:</strong> <span style="color:#27a745">${lesson}</span>
        </div>`;

        // Hide modal and reset form
        closeFailureModal();
        this.reset();
    };
});
</script>
</body>
</html>
